<html>

<head>
  <title>Gráfico regiones</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700&display=swap">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>

<body>
  <style>
    body {
      font-family: 'Heebo', sans-serif;
    }

    #grafico-principal {
      width: 1100px;
      margin: 2rem auto;
      box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.2);
      padding: 1rem 1rem 0 1rem;
    }

    #cuerpo-parte-sup {
      display: flex;
      flex-direction: row;
      height: 60%;
      justify-content: space-around;
      padding-top: 10px;
      padding-bottom: 10px;
    }

    #head-grafico {
      margin: 0 0 20px 0;
    }

    #mapa {
      height: 100%;
      margin: 0 auto;
      display: flex;
      align-items: center;

    }

    .divisoria-titular {
      margin: 0;
      height: 2px;
      border: none;
      background-color: black;
    }

    #titular {
      margin: 0;
    }

    #pie-grafico {
      padding-bottom: 20px;
      display: flex;
      flex-direction: row-reverse;
      justify-content: space-between;
    }

    .texto-pie {
      color: #aaa;
      margin: 0;
    }

    #div-tabla {
      height: 100%;
      font-size: 18px;
      display: flex;
      flex-direction: row;
    }

    #columna-region-nom,
    #columna-region-datos {
      display: flex;
      flex-direction: column;
      flex-grow: 1;
      /* Permitir que las columnas crezcan y se contraigan */
    }

    .fila-region-nom {
      border-top: rgb(228, 228, 228) solid 1.5px;
      border-bottom: rgb(228, 228, 228) solid 1.5px;
      border-right: rgb(68, 68, 68) solid 1.5px;
      padding: 0 1rem 0 1rem;
      background: linear-gradient(to right, #fff, #f0f0f0);
      flex-grow: 1;
      display: flex;
      align-items: center;
    }


    .fila-region-datos {
      border-top: rgb(228, 228, 228) solid 1.5px;
      border-bottom: rgb(228, 228, 228) solid 1.5px;
      padding: 0 1rem 0 1rem;
      display: flex;
      justify-content: center;
      flex-grow: 1;
      align-items: center;
      font-weight: bold;
      color: white;
      text-align: center;
      text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.5); /* Añadir sombra de texto */
    }

    #nota-ceuta-melilla {
      display: none;
    }

    #paneles {
      background-color: #eeeeee;
      height: 100px;
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      font-size: 18px;
    }

    #paneles-colores {
      background-color: #eeeeee;
      padding: 2rem;
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      align-items: center;
      font-size: 18px;
    }

    .sec-panel {
      border-right: white solid 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 50px;
    }

    #colorSelectors {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-weight: bold;
      justify-content: right;
    }

    #color-individual {
      display: flex;
      flex-direction: row;
      align-items: center;
      margin: 2px;
    }

    #scaleInputs {
      display: flex;
      align-items: center;
      flex-direction: column;
    }

    #input-individual {
      display: flex;
      flex-direction: row;
    }

    input {
      height: 35px;
      font-size: 18px;
    }

    #toggleSymbols {
      height: 20px;
      width: 20px;
    }

    #paneles-textos {
      display: flex;
      flex-direction: row;
      align-items: center;
      background-color: #eeeeee;
      margin-top: 2px;
      justify-content: center;
      font-size: 18px;
    }

    #paneles-textos label {
      margin-right: 10px;
      font-size: 18px;
    }

    #subtitulo {
      font-weight: normal;
      font-size: 21px;
      line-height: 1.5;
      width: 100%;
      margin: 0;
    }

    #downloadButton {
      font-size: 18px;
      font-weight: bold;
      background-color: white;
      padding: 1rem;
    }

    #downloadButton:hover {
      font-size: 18px;
      font-weight: bold;
      background-color: rgb(165, 165, 165);
      padding: 1rem;
      cursor: pointer;
    }

    #paneles textarea {
      font-size: 18px;
    }

    #panel-sugerencias-color{
      background-color: #eeeeee;
      display: flex;
      justify-content: center;
      align-items: center;
      padding:2rem;
      flex-direction: column;
      margin-top:2px;
    }

    .titulo-sugerencia{
      font-size: 20px;
    }

    select{
      font-size: 18px;
    }

    #panel-sugerencias-color p{
      font-size: 18px;
    }
  </style>

  <div id="paneles">
    <!-- Botón para subir datos y casilla de verificación -->

    <div class="sec-panel">
      <input type="file" id="fileInput" accept=".xlsx, .xls, .csv" />
    </div>
    <div class="sec-panel">
      <label>
        <input type="checkbox" id="toggleSymbols" />
        Activar/Desactivar símbolos de variación
      </label>
    </div>
    <div class="sec-panel">
      <div class="sec-panel">
        <button id="downloadButton">Descargar Mapa</button>
      </div>
    </div>
  </div>
  <div id="paneles-textos">
    <div class="sec-panel">
      <label for="tituloInput">Título </label>
      <textarea id="tituloInput" rows="2" cols="30"></textarea>
    </div>
    <div class="sec-panel">
      <label for="subtituloInput">Subtítulo </label>
      <textarea id="subtituloInput" rows="2" cols="30"></textarea>
    </div>
    <div class="sec-panel">
      <label for="fuenteInput">Fuente </label>
      <textarea id="fuenteInput" rows="2" cols="30"></textarea>
    </div>
    <div class="sec-panel">
      <label for="notaCeutaMelillaInput">Nota a pie de gráfico </label>
      <textarea id="notaCeutaMelillaInput" rows="2" cols="30"></textarea>
    </div>
  </div>
  <div id="grafico-principal">
    <div id="head-grafico">
      <h2 id="titular">
        Titular del gráfico
      </h2>
      <h3 id="subtitulo" style="display: none;"></h3>
      <hr class="divisoria-titular">

    </div>
    <div id="cuerpo-parte-sup">
      <div id="div-mapa">
        <svg id="mapa" data-name="mapa" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1760 1537.4">
          <defs>
            <style>
              .linea-svg-canarias {
                fill: none;
                stroke: #aaa;
                stroke-width: .8px;
              }

              .linea-svg-canarias,
              .poligono-svg-ccaa {
                stroke-miterlimit: 10;
              }

              .poligono-svg-ccaa {
                fill: #c9c9c9;
                stroke: #fff;
                stroke-width: 2px;
              }
            </style>
          </defs>
          <polygon id="madrid" class="poligono-svg-ccaa"
            points="611.1 619.7 612.4 612.7 620.7 603.1 626.9 602.2 628.8 590.7 632.2 587.1 638.7 587.6 644.6 579.9 644 563.4 648.5 560.9 652 553.9 663 552.1 663.7 541 676.8 521.8 683.1 523.9 688.5 520.8 692.7 509.9 692 504.7 701.5 490.8 714.1 486.5 722.8 474 727.2 472.2 735.7 461 745.3 458.3 751.9 470.5 760 475.4 758.3 479.2 763.7 485.4 757 499.8 757.4 507.6 754 509.8 753.4 516.4 750.1 522.2 757.6 527.3 757.2 541.6 773.2 548.3 772.3 555.2 789.2 569.3 789.3 581.6 794.9 582.1 798.2 587.9 795.4 599.7 791.7 603.4 789.9 614.5 800.4 608.1 802.6 611 805 627.3 803.3 632.5 808.1 638.4 803.5 644.5 776 647.4 772.7 643 766.2 643.8 764.1 648.7 748.4 649.1 746.5 653.4 738.7 654.3 732.6 658.4 733.1 662.1 723.2 664 710.9 675.3 704 672.8 702 668.7 711.5 665.3 721.3 658.4 734.6 647.3 736.6 638 722 631.6 715.4 632.8 711.7 626.8 707.3 629.1 703.1 624.6 687 621 676.5 611.6 672.4 615.6 654.1 610.1 647.8 619.4 639.8 610.7 639.9 604.3 629.5 613.3 628.1 616.9 616.8 622.7 611.1 619.7" />
          <polygon id="murcia" class="poligono-svg-ccaa"
            points="900 984.5 901.5 978.1 910.4 970.2 916.7 955.4 929.3 949.7 935.9 939.9 944.1 942.1 956.1 939.8 977.4 926.1 984.5 928.7 986.7 937.6 998 937.3 1011.5 926.9 1011.1 908.3 1008.9 901.2 1010.3 896.1 1014.9 893.1 1015.4 881.8 1021.4 875 1025.9 872.8 1028.8 877.3 1039.3 868.5 1049.6 864.4 1057.8 867.3 1058.3 871.6 1069.8 880.8 1073.1 894.6 1069.9 902.8 1071.5 907 1062.7 916.3 1062.4 931.9 1074.6 936.1 1077.3 946.8 1074.8 956 1068.5 966.2 1070.4 976.3 1077.7 986.7 1083.5 997.9 1095.3 1011 1103.9 1013.9 1104.5 1018.7 1092.8 1030.9 1091.4 1035 1095.9 1041.8 1106.8 1048.9 1109.3 1053.2 1101.2 1055 1096.3 1058.2 1088.9 1058 1083.7 1061.6 1075.2 1056.4 1071.7 1058.1 1063.7 1056.7 1057 1061.6 1047 1058.4 1038.7 1060.6 1031.5 1060.1 1021.4 1068.8 1012.9 1074.1 1010.3 1083 1006.2 1081.5 997 1086.3 991.9 1090.7 978.1 1079.7 964.1 1077.8 946.9 1050.5 942.6 1042.3 944.7 1033.2 943 1025.5 944.8 1014.7 937.2 1008.3 931.1 1008.8 928.2 1005 921.9 1007 908 994.8 905.5 988.3 900 984.5" />
          <polygon id="cantabria" class="poligono-svg-ccaa"
            points="761.1 115.4 749.6 115 737.6 112.1 730.9 107 724.2 118.1 707.2 128.7 700.2 131.5 692.9 138 687 151.2 693.1 155 699.9 152.1 703 147 707.8 151.8 703.5 158.4 708.4 162.2 708.9 174.2 697.6 176.6 690.3 181.5 685.9 179.7 685.9 170.8 675.4 181 673.2 175.8 666.5 176.1 661.9 171.2 669.3 166.1 666.5 161.7 660.1 166.3 656.7 163.8 654.9 146.6 640.8 143.8 634.5 132.8 628.7 129.1 624.4 132.2 618.6 130.6 613.5 135.3 607.6 132.7 603.5 136 589.9 134 586.9 125.8 580.5 122.7 575.9 116.7 577.2 107 589.3 106.4 592.7 98.4 591.8 93.7 600.7 92.2 608.5 86.1 618.4 89.6 617.3 75.1 619.7 69.3 628.6 68.5 649.7 70.2 671.4 64.8 673.8 62.3 685.9 61 693 55.9 703.6 54.6 710.2 51.2 714.9 55.6 725.9 54.6 737.9 48 744.1 48.8 748.9 54.3 759.3 57.1 760.8 65.7 772.4 65.3 786.3 69.2 795.2 76.4 794.7 85.7 788 88.8 770.7 86.9 764.4 94.4 758 97.3 761.1 115.4" />
          <g id="cyl">
            <polygon class="poligono-svg-ccaa"
              points="842.8 192 845 197.8 858.8 196.7 862.2 201 862.2 201 862.2 201 868.6 200.3 865.5 192.5 871.5 184.6 865.5 179.4 862.1 180.4 849.7 175.2 838.5 176 832 184.8 832 184.8 832 184.8 842.8 192" />
            <polygon class="poligono-svg-ccaa"
              points="971.5 360.2 963.2 350.8 967.6 343.6 967 337.5 962.6 329.8 962.7 320 951.8 327.1 946.5 328.2 940.5 322.2 929.1 320.5 929 310.4 923.2 302.5 926.7 296.4 913.4 296.4 903 288.9 887.5 290.3 872.9 306.2 869.2 314.7 863.2 313 855.7 314 846.6 310 852.7 299.1 849.2 292.4 844.1 292.6 840.6 299.6 841.1 305.9 826.4 310.3 823.3 298.6 810.6 299.2 806.5 291 798.4 279.1 803.5 271.4 800.9 252.8 808.2 249.1 806.9 240.1 809.1 236.5 803 228.4 805.7 222 797.6 219.6 806.8 210.9 806.1 202.6 814.4 201.6 830 205.1 833.3 202.6 828.5 199.8 827.6 193 816.7 190.3 808.6 180.3 797.4 180.3 794.5 173.4 795.6 163.4 790.4 162 784.4 167.5 778.5 160.9 786 147.8 796.3 150.5 798.7 155.9 812.6 155.1 817.4 149.8 809.6 144.3 806.4 138.2 796.3 137.8 797.7 121.8 791.5 117.6 795.8 108.2 786.2 108.5 779.1 104.6 769.7 111.7 761.1 115.4 749.6 115 737.6 112.1 730.9 107 724.2 118.1 707.2 128.7 700.2 131.5 692.9 138 687 151.2 693.1 155 699.9 152.1 703 147 707.8 151.8 703.5 158.4 708.4 162.2 708.9 174.2 697.6 176.6 690.3 181.5 685.9 179.7 685.9 170.8 675.4 181 673.2 175.8 666.5 176.1 661.9 171.2 669.3 166.1 666.5 161.7 660.1 166.3 656.7 163.8 654.9 146.6 640.8 143.8 634.5 132.8 628.7 129.1 624.4 132.2 618.6 130.6 613.5 135.3 607.6 132.7 603.5 136 589.9 134 586.9 125.8 580.5 122.7 575.9 116.7 577.2 107 570.5 96.8 563.9 99.3 557.2 106 548.4 107.2 544.5 113.7 543.6 121 535.1 120.8 528.3 124.2 520.3 125.3 507.3 123.5 506.3 130.2 498.8 129.2 487 135.7 475.7 132.9 467.2 129 462.7 131.5 457.9 144.4 446.9 144.7 433.2 135.7 431 127.6 425 129.3 415.8 127.2 416 132.2 410 135.3 403.6 130.2 396.8 136.4 385.3 133.3 381 128.7 376.3 132.2 369.4 150.4 357 154.5 348.5 152.3 334.2 153.6 328.1 156.9 321.2 153.9 320.7 158.6 315.1 161.2 318.9 170.3 315.6 176.5 306.8 184.6 296.7 187.9 292.6 192.7 297.2 200.7 292.4 203.6 292.8 211.3 289.3 220.1 291.8 225.4 301.9 227.9 308.2 223.5 323.2 232.3 320.2 243 321.6 246.9 332.8 251.5 331.9 262.1 324 273.1 313.1 276.8 306.5 283.3 305.6 289.5 294.1 301.2 302.8 310 300.3 319.1 305.7 323.6 321.6 323.5 322.8 315.4 328.3 316.9 330.7 324 337.3 325.7 350.2 323.1 356.8 327.3 353.8 334.3 360.7 335.7 357.3 351.7 354.6 357.2 356.8 368.6 361.5 372.8 369.2 369.4 381.6 370.1 388.6 372.6 394.9 377.7 403.2 387.7 393 401.6 385.1 415.3 386.8 419.6 376.8 422.9 371 434.2 367 434.9 353.8 445.6 344.6 444 337.4 455.1 328.1 465.3 330.3 468.9 323.3 479.7 319.6 481.7 309.5 479.9 307.3 483.5 316.5 495.2 319.3 505.4 323.8 512.8 320.3 528.8 325 544.2 318.5 560.6 324.2 563.2 325 569.8 317.9 579.8 319.8 587.4 326.8 594.7 325.5 599.8 316.1 606.5 315.9 610.7 319.8 614.5 330 614.8 334.8 610.9 340.9 611.9 351.8 610.7 355.5 607.4 355.2 600.8 358.3 597.7 379.2 588.7 384.5 580.6 389.6 579.9 396.6 574.2 401.6 574.7 407.3 579.1 410.9 585.2 418.2 588.7 417 595 425.6 598.9 426.9 604.8 437.8 608.9 442.6 601.2 454.1 597 457.9 608.9 467.3 607 480 619.9 488.2 623.5 495.9 621.3 501.2 613.8 512.4 611.9 509 619.5 509.3 629.2 513.4 636.8 515.4 638.2 528.9 638.2 531 642.5 540.2 639.2 547.7 631.2 554.3 629.5 555.9 634.4 561.7 635.9 566.3 633.4 567.9 627.1 581.6 616.6 582.1 609.9 587.6 612.3 595.7 608.7 597.2 620.8 603.3 623.1 611.1 619.7 612.4 612.7 620.7 603.1 626.9 602.2 628.8 590.7 632.2 587.1 638.7 587.6 644.6 579.9 644 563.4 648.5 560.9 652 553.9 663 552.1 663.7 541 676.8 521.8 683.1 523.9 688.5 520.8 692.7 509.9 692 504.7 701.5 490.8 714.1 486.5 722.8 474 727.2 472.2 735.7 461 745.3 458.3 754.3 455.1 757.7 449.7 762.3 450.2 764.1 442.5 782.2 442.3 785.8 435.5 790.6 434.4 807 439.6 822.2 435.5 827 430.4 831.1 431.4 832.2 439.5 843.7 443.4 851.6 439.3 852.5 443.4 864.5 448.9 869.6 456.1 869.8 462.6 877.3 461.2 881.9 466.6 883.5 473.2 892.2 476 898.2 471.7 902.4 476.9 910.1 475 914.1 469.9 921.5 472.2 929 468.9 935.7 470.2 937.4 461.4 933.8 457.2 925.2 454.9 922.1 431.9 928.7 421.4 931 410 939.5 413.3 940.4 420.6 950.1 416.4 950.2 407.2 946.6 403 948.3 392.7 945 383.3 954.1 383.7 962.4 372.8 968.3 372.9 971.6 366.2 971.5 360.2" />
          </g>
          <polygon id="asturias" class="poligono-svg-ccaa"
            points="619.7 69.3 617.3 75.1 618.4 89.6 608.5 86.1 600.7 92.2 591.8 93.7 592.7 98.4 589.3 106.4 577.2 107 570.5 96.8 563.9 99.3 557.2 106 548.4 107.2 544.5 113.7 543.6 121 535.1 120.8 528.3 124.2 520.3 125.3 507.3 123.5 506.3 130.2 498.8 129.2 487 135.7 475.7 132.9 467.2 129 462.7 131.5 457.9 144.4 446.9 144.7 433.2 135.7 431 127.6 425 129.3 415.8 127.2 416 132.2 410 135.3 403.6 130.2 396.8 136.4 385.3 133.3 381 128.7 376.3 132.2 369.4 150.4 357 154.5 348.5 152.3 334.2 153.6 328.1 156.9 321.2 153.9 319.6 146.4 315.2 141 306.1 137 300.6 138.3 306.3 124.4 320.7 117.2 321.5 113.7 315.2 106.7 308.9 114 304.2 115.2 300.9 109.5 303.1 105.3 290.5 95.8 290.2 85.5 285.4 85.2 281.5 79.8 282 73 275.6 70.9 276.2 62.7 285.1 63.3 292.3 54.3 294.3 42.4 305.8 37.1 339.2 39.8 346.5 38 364.5 41.6 368.1 38.7 379.7 41.2 388 39.1 396.3 34.5 404 39 413.1 40.4 423.7 35 428.2 37.1 434.9 34.9 445.9 25.3 454.3 27.2 458.7 34.9 474.2 41.2 492.7 42.4 503.4 40.5 506.9 44.1 518.6 44.1 528.9 54.8 540.9 53.1 551.9 57.3 565 57.8 586.5 62.8 590.5 65.2 606.1 68.8 619.7 69.3" />
          <path id="c-valenciana" class="poligono-svg-ccaa"
            d="M1103.9,1013.9l-8.6-2.8-11.9-13.2-5.8-11.2-7.3-10.4-1.8-10.2,6.2-10.2,2.5-9.2-2.7-10.7-12.3-4.2.3-15.6,8.8-9.2-1.6-4.3,3.2-8.2-3.3-13.7,8.4-.2,6-6.4-5.8-13,4.2-1.5-1.5-19.2-2.4-7.5-19,2.7h-5.3c0-.1-10.3-16-10.3-16l-4.2-2.8-.8-5.7,5-12.6,4.2-4.8,4.2-20.9-20.2-6.3-4.3.5-8-6.7-10.9-5.8-1.9-7.3,1.1-17.6,5.5-2.1,5.6-13.1,6.4-5.8,7.1,3.2,6.6-4.7-1.8-6.7,7.8-11.8,1.9-8.6-.5-15.1,8-3.8,19.9-1.5,8.2,3.6,1.8,15.4,5.5,3.6,9-5.8-4.2-4.3-2.1-6.8,1.5-5.4,5.7-1.7,3.6-8.7,5.6.4,13.6-5.5-1.9-5.2,5.4-5,5.5-20.3,6.4,3.9,5.5-1.1,8.8-4.9-2.1-5.4,5.4-2.9,5.6-7.7,4.4-2.6-8.3-11.5,9.5-6.3-3.9-6.6,1.4-6.1-4-8.4-7.5-3.5,3.1-9.2,6.3,2.6,9.2-4.9,1.6-10.8,7.6-5.8,4.9,6,8,4.4,10.3-.2,3.4,6.4,9.1-6.1,7.5-1h6.1l3.1,5.5,6.5,2.6-3.2,4.5,1.4,4.9,4.8,2.8,9.5,1.3,5.4,4.6.6,5,10.2,4.6-4,8.3-8.4,12.3-1.9,6.5-9.5,14.1-5.5,4.6-3.1,7.5-7.9,4.5-10.5,20.2-9.1,4.4-5.4,11.7-1.9,8.6-10.4,9.9-13.4,22.9-2.5,11.3-6.7,6.8-1.8,6.6-5.2,8.3-2.3,16.7,3.6,14.5,11.2,25.8-2.5,6.5,3.7,10.8,9.6,18,14.3,15.4,15.9,4.2,11.9,7.3-1,3.7,4.9,4.4-8.3,10.1-7.2,4-4,5.8-10,1.4-6.5,6.7v6.1c-.1,0-5.2,4.8-5.2,4.8l-6.9-1.9-5.4,3.3-14.3,5.5-9.4,6.5-3.3,5.2-1,8.6-4.8-.6-7.7,4.9-1.7,10.8v12c.1,0-7.9.6-7.9.6l-6.9,7.5-1.7,8.9-1.4,17.7-5.1,2.1-1.2,4.7-5.8,7.1-1.6,8.4ZM1015.3,631.9l12.1,2.7,9.1-7.1,6.1,9.8,11.5-.2,9.8,9.1-1.6,4.1-10.4,4.4-10.5,2.5-11.5-3.6-6.1-3.8-9.6-16.2,1.1-1.7Z" />
          <polygon id="galicia" class="poligono-svg-ccaa"
            points="294.3 42.4 292.3 54.3 285.1 63.3 276.2 62.7 275.6 70.9 282 73 281.5 79.8 285.4 85.2 290.2 85.5 290.5 95.8 303.1 105.3 300.9 109.5 304.2 115.2 308.9 114 315.2 106.7 321.5 113.7 320.7 117.2 306.3 124.4 300.6 138.3 306.1 137 315.2 141 319.6 146.4 321.2 153.9 320.7 158.6 315.1 161.2 318.9 170.3 315.6 176.5 306.8 184.6 296.7 187.9 292.6 192.7 297.2 200.7 292.4 203.6 292.8 211.3 289.3 220.1 291.8 225.4 301.9 227.9 308.2 223.5 323.2 232.3 320.2 243 321.6 246.9 332.8 251.5 331.9 262.1 324 273.1 313.1 276.8 306.5 283.3 305.6 289.5 294.1 301.2 302.8 310 300.3 319.1 297.6 322.7 289 322.7 287.2 318.7 280.3 315.7 274.3 319.4 276.1 328.1 273 334.9 258.3 341.2 251.5 339.7 245.8 345.8 240 337.5 224.3 343.6 221.1 336.9 207.6 330.2 191.2 334.9 185.3 340.3 179.6 334.5 170.8 337.1 167.8 343.7 152.6 347.3 148 345.7 148.4 338.3 141.3 329.2 148.2 317.1 158.3 311.2 156.8 301.7 153.3 299.7 145.8 302.5 144.4 291.9 136.2 290.6 130.2 296 120.2 300.6 101.7 300.5 99.2 304.5 87.9 305.5 83.9 313.5 73 320.3 72.7 324.2 55.4 334.4 55.1 307.1 53.7 296.7 63 293.8 63.9 281.6 73.7 274.7 78.6 268.9 88.1 264.5 90.3 254 80.3 265.4 74.1 266.5 66.8 271 58.7 268.6 63.8 260.7 71.8 254.9 73.3 249.9 83.5 240.7 80.5 237.8 69.6 246.3 60.6 246.7 55 234.4 64.3 226.9 61.4 217.8 70.2 209.3 63.1 200.5 53 202.2 46 212.2 36.3 217.8 30.4 211 35.4 200.8 37.1 190.4 41.3 184.7 42.3 178 36.6 174.4 29.8 185.1 22.8 175.9 26.4 170.1 20.8 161.4 23.5 155.9 10.1 151.8 1.8 152.5 6.6 143.5 3 131.1 7.4 123.7 14.6 120.6 12.5 112.3 17.1 106.4 23.2 104.5 32.5 106.2 42.6 98.4 51.7 85.5 51.6 82.2 64.2 81.5 67.6 84.9 78.1 87.5 92.8 82.1 98.8 83.7 112.3 71.5 117.9 70.1 120.4 78.8 124.2 77.6 124.3 69.5 129.7 67.3 136.7 76.3 141 69.4 124.9 55.7 126.9 47 149.3 29.8 157.4 21.3 161.1 13.9 168.4 13.8 186.3 1.9 186.5 11.9 183.4 20.5 189.6 19.5 195.6 8.6 205.7 3.2 222.8 13.2 230.4 8.2 237.8 14.1 252.3 19.8 252.7 22.8 266.8 38.5 278 40.7 291.1 39.8 294.3 42.4" />
          <polygon id="andalucia" class="poligono-svg-ccaa"
            points="307.3 954.5 316.8 959.2 325 959.5 323.1 970.4 329.6 973.5 347.3 972.8 352.6 980.1 351.8 984.4 363.7 985.6 374.2 979.1 380.2 980.7 381.8 987.1 388.4 992.3 401.6 995 403.8 997.9 412.3 991.9 421 989.3 433.6 989.5 439.4 977.6 436.9 974.3 443.4 963.3 460.9 956.9 467.8 958.9 467 963.9 461.1 968 462.1 974.4 467.2 975 474.9 966.1 481.2 967.1 487 962.4 489.6 954.7 488.8 945.4 482.7 934.3 481.2 925.3 483.4 917.5 489.7 912.6 494.3 912.2 502.5 904.5 509.1 892.5 517 893.7 519 888.2 523.9 885.7 529.8 878.8 535 877.3 534.9 871.3 543.7 872.2 550.7 868.7 556.5 874.3 563.9 876.5 573.7 876.6 574.8 887.7 583.9 890.5 599.9 898.6 610.4 907.6 619.7 912.5 627.5 922.9 629.7 922.7 651.2 931.7 650.1 924.6 657.2 923.5 665.6 926.1 671.4 925.9 690.8 928.6 704.7 927.1 710.7 919.4 720.7 919 734.9 924 739.4 922.1 739.7 914.5 745 915.6 747.3 921.5 754 923.4 760.1 921.9 766.4 916.5 766.6 910.6 772.8 909.5 778.8 913 798.2 916.6 806.6 910.1 814.3 920.6 815.5 915.6 823 910.7 829.2 913.8 845.1 901.1 857.3 907.1 866.7 904.4 871 908.1 870.3 920.7 881.7 923.4 881.9 940.3 887.2 941.9 886.4 958.5 872.9 975 896 984.9 900 984.5 905.5 988.3 908 994.8 921.9 1007 928.2 1005 931.1 1008.8 937.2 1008.3 944.8 1014.7 943 1025.5 944.7 1033.2 942.6 1042.3 946.9 1050.5 964.1 1077.8 978.1 1079.7 991.9 1090.7 986.5 1093.7 982.1 1101.8 970.5 1114 966.9 1123.9 963.5 1140.4 956.9 1153.8 956.2 1161.8 951.1 1162.3 948.3 1167.9 943.9 1170.4 943.7 1178 936.3 1182.4 935.7 1187.7 930.4 1189.9 928.4 1194.6 919.1 1196.4 906.2 1180.3 897.5 1177.1 888.2 1181.5 882.8 1177.9 871.6 1181.2 866.7 1187.8 864.1 1195.6 860.2 1199.9 853.6 1202.6 844.5 1202.9 838.8 1198.9 833.4 1200.1 828.4 1194 822.9 1191.7 817.9 1193.7 812.1 1192.3 794.9 1192.3 783.4 1191.1 771.2 1193.8 767.9 1197.6 760.9 1200.9 752.7 1200.4 748.8 1196.6 743.6 1197.6 737.5 1192.9 729.6 1192.6 727.9 1195 715.9 1195.2 707.2 1191.2 691.3 1195.6 675.7 1192.3 671.3 1196 653.7 1198.3 631.8 1197.2 620.1 1216.3 609.8 1220.5 603.3 1231 590.2 1234.7 575.1 1230.9 565.2 1232.1 556.1 1238.6 545.5 1240.4 533.2 1246.4 528.3 1252.1 524.7 1262.5 522.1 1264.2 515.8 1275.4 513 1287.6 501.6 1284.1 499 1290.1 501.3 1300.8 493.8 1303.5 482.6 1309.8 478.6 1310.5 472.7 1303.8 464.9 1302.8 457 1298.3 453.9 1299.7 444 1287.1 438.5 1282.6 429.5 1283.8 420.9 1280 413 1265.2 409.3 1264.9 404.1 1253.2 399.3 1249.3 398 1238.1 405.2 1230.5 395.9 1230.7 398.7 1222 393.3 1219.3 389 1213.2 380.5 1212.8 376.8 1208.6 370.5 1194 381.9 1185.5 376.3 1182.7 370.4 1168 360.2 1155.2 352.4 1149.2 325.4 1132.3 314.7 1127.5 309.3 1123 304.8 1124.1 296.3 1119.2 279.7 1117.8 263.5 1118.9 250.3 1123.7 245.8 1121.6 243.9 1106.8 241.4 1100.9 241.6 1088.2 239.4 1078 234.6 1066.6 231 1061.7 239.6 1046.7 240 1041.4 244.5 1030.2 257 1018.3 265.5 1001 267 990 272.3 988.2 281.8 988.5 285.7 981.6 290.3 985.5 298.2 985 299.8 973.6 303.9 966.1 302.5 962.6 307.3 954.5" />
          <path id="aragon" class="poligono-svg-ccaa"
            d="M1060.1,229.9l-3.5,6.3,9.4,2.2-5.9-8.5ZM1054.9,661.1l-3-6.4,10.4-4.4,1.6-4.1-9.8-9.1-11.5.2-6.1-9.8-9.1,7.1-12.1-2.7-3.3-6.8-4.7-3.2-3.8,2.1-33.9-35.1,7-10.9,7.3-4-1.2-9.2,2-6.6h6.7c0,0,4.6,3.1,4.6,3.1l6.8-5.7-2.5-3.3,3.8-12.3-3-5.5,2.5-7-.6-9.5-5.7-4.9-4.8-9.2,2.3-4.9-6.8-8.7-7.2-6-11.1-13-8.6-3.1-2.7-4.4-5.4-.9-3.4-5.8-12,4.4-3.6-4.1-8.6-2.3-3.1-23.1,6.6-10.5,2.3-11.3,8.5,3.2.8,7.4,9.7-4.2v-9.3c0,0-3.5-4.1-3.5-4.1l1.8-10.3-3.3-9.5,9,.4,8.3-10.9,5.9.2,3.4-6.7v-6c-.1,0-8.4-9.4-8.4-9.4l4.4-7.2-.5-6.1-4.5-7.7v-9.9c.1,0,1.3-7.2,1.3-7.2l10.4,2.2,4.2,5.5,7.9-.4,7.6,2.8,2.4,4,9.4,3,2.8-2.5,10.3,2,5.1-5.3,5.5-13,4.5-4.4-.7-5.1h-5.4c0-.1-6-9.4-6-9.4l.9-9.6-3.2-7.1,2.3-12.1,9-11.2-4-4,2.3-8,8.9-10.1-1.9-7.2,2.9-5.9,5.1,2.5,7.1-9.5,2.4-8.9h14.7c0-.1,1.4-9.2,1.4-9.2l10.6-2.5,5.9-8.1,6.8-4.5-1.2-10.8,5.5-5.3,4-7.9,7.6.3-1.1,3.9,16.6,11.4,6.6,9.3,5.5-7.8,8.6,5.1,6.3-.5,6-6.4,5.4-1.1,16.4,9.9,3.3-1.3,5.8,10.3,5.8,6.2,8.3,2.5,13.8-4.3,8.9-4.7,10.8,3.7,4.6,7.6,8.4-9,8,6,7.7-1.6h16.1c0,0,7,1.6,7,1.6l4.5,5.6,1.7,6.7,7.7,1.9-1.1,6.3-4.3,7.3,1.5,4.2-5.2,6,8,21.9-3.4,17.6-2.3,3.9-2.5,12.8.8,5.2-6.4,17.2-11.6,15.7,5.2,1.8-1.3,6.6-6.3,11-7.9,3.4-1.8,6.2-8,1.1-10.2,13.3,3.2,9.1-.6,5.2,6.8,1.2,5.7,8.6-6.3,9-7.2,1.8v11.4c0,0-2.8,3.4-2.8,3.4l6.8,6.9-3,3.9,4.7,9-3.6,9.2h-4.5c0,0-2.5,10.5-2.5,10.5l-7,5.8h-4c0-.1-2.2,7.9-2.2,7.9l3.7,7.7,4.2,2.2,2.8,10.6-3.9,7.7-.4,10.8,3.5,6-13.9,15.1-7.5,1-9.1,6.1-3.4-6.4-10.3.2-8-4.4-4.9-6-7.6,5.8-1.6,10.8-9.2,4.9-6.3-2.6-3.1,9.2,7.5,3.5,4,8.4-1.4,6.1,3.9,6.6-9.5,6.3,8.3,11.5-4.4,2.6-5.6,7.7-5.4,2.9,2.1,5.4-8.8,4.9-5.5,1.1-6.4-3.9-5.5,20.3-5.4,5,1.9,5.2-13.6,5.5-5.6-.4-3.6,8.7-5.7,1.7-1.5,5.4,2.1,6.8,4.2,4.3-9,5.8-5.5-3.6-1.8-15.4-8.2-3.6-19.9,1.5Z" />
          <polygon id="clm" class="poligono-svg-ccaa"
            points="513.4 636.8 515.4 638.2 528.9 638.2 531 642.5 540.2 639.2 547.7 631.2 554.3 629.5 555.9 634.4 561.7 635.9 566.3 633.4 567.9 627.1 581.6 616.6 582.1 609.9 587.6 612.3 595.7 608.7 597.2 620.8 603.3 623.1 611.1 619.7 616.8 622.7 628.1 616.9 629.5 613.3 639.9 604.3 639.8 610.7 647.8 619.4 654.1 610.1 672.4 615.6 676.5 611.6 687 621 703.1 624.6 707.3 629.1 711.7 626.8 715.4 632.8 722 631.6 736.6 638 734.6 647.3 721.3 658.4 711.5 665.3 702 668.7 704 672.8 710.9 675.3 723.2 664 733.1 662.1 732.6 658.4 738.7 654.3 746.5 653.4 748.4 649.1 764.1 648.7 766.2 643.8 772.7 643 776 647.4 803.5 644.5 808.1 638.4 803.3 632.5 805 627.3 802.6 611 800.4 608.1 789.9 614.5 791.7 603.4 795.4 599.7 798.2 587.9 794.9 582.1 789.3 581.6 789.2 569.3 772.3 555.2 773.2 548.3 757.2 541.6 757.6 527.3 750.1 522.2 753.4 516.4 754 509.8 757.4 507.6 757 499.8 763.7 485.4 758.3 479.2 760 475.4 751.9 470.5 745.3 458.3 754.3 455.1 757.7 449.7 762.3 450.2 764.1 442.5 782.2 442.3 785.8 435.5 790.6 434.4 807 439.6 822.2 435.5 827 430.4 831.1 431.4 832.2 439.5 843.7 443.4 851.6 439.3 852.5 443.4 864.5 448.9 869.6 456.1 869.8 462.6 877.3 461.2 881.9 466.6 883.5 473.2 892.2 476 898.2 471.7 902.4 476.9 910.1 475 914.1 469.9 921.5 472.2 929 468.9 935.7 470.2 937.4 461.4 949.4 457 952.9 462.8 958.3 463.7 961 468.1 969.6 471.2 980.7 484.2 987.9 490.2 994.7 499 992.4 503.8 997.2 513 1002.9 518 1003.6 527.4 1001.1 534.5 1004.1 540 1000.3 552.3 1002.8 555.6 996 561.3 991.4 558.2 984.7 558.2 982.7 564.8 983.8 574 976.6 578.1 969.6 588.9 1003.5 624 1007.3 622 1012 625.1 1015.3 631.9 1014.2 633.6 1023.8 649.8 1029.9 653.6 1041.4 657.2 1051.9 654.7 1054.9 661.1 1046.9 664.9 1047.4 680 1045.5 688.6 1037.7 700.3 1039.5 707 1032.8 711.8 1025.7 708.6 1019.3 714.4 1013.6 727.5 1008.1 729.6 1007 747.2 1008.9 754.5 1019.8 760.4 1027.8 767.1 1032.1 766.6 1052.3 772.8 1048.2 793.7 1043.9 798.5 1038.9 811.2 1039.8 816.9 1044 819.6 1054.3 835.5 1059.6 835.6 1078.5 832.9 1080.9 840.4 1082.4 859.6 1078.3 861.1 1084.1 874.2 1078.1 880.6 1069.8 880.8 1058.3 871.6 1057.8 867.3 1049.6 864.4 1039.3 868.5 1028.8 877.3 1025.9 872.8 1021.4 875 1015.4 881.8 1014.9 893.1 1010.3 896.1 1008.9 901.2 1011.1 908.3 1011.5 926.9 998 937.3 986.7 937.6 984.5 928.7 977.4 926.1 956.1 939.8 944.1 942.1 935.9 939.9 929.3 949.7 916.7 955.4 910.4 970.2 901.5 978.1 900 984.5 896 984.9 872.9 975 886.4 958.5 887.2 941.9 881.9 940.3 881.7 923.4 870.3 920.7 871 908.1 866.7 904.4 857.3 907.1 845.1 901.1 829.2 913.8 823 910.7 815.5 915.6 814.3 920.6 806.6 910.1 798.2 916.6 778.8 913 772.8 909.5 766.6 910.6 766.4 916.5 760.1 921.9 754 923.4 747.3 921.5 745 915.6 739.7 914.5 739.4 922.1 734.9 924 720.7 919 710.7 919.4 704.7 927.1 690.8 928.6 671.4 925.9 665.6 926.1 657.2 923.5 650.1 924.6 651.2 931.7 629.7 922.7 627.5 922.9 619.7 912.5 610.4 907.6 599.9 898.6 583.9 890.5 574.8 887.7 573.7 876.6 563.9 876.5 556.5 874.3 550.7 868.7 558 866.9 560.2 863.4 564.1 847.9 567.7 842.4 576.1 843.4 577.8 835.3 565.3 827.8 561.6 814 574.7 818.5 579.1 813.4 573 807.7 575.7 798.4 581.3 790.6 590 791.3 594.4 788.8 587.6 770.3 594.2 766.2 599.4 753 596.7 748.4 588.4 754.4 571.3 762 563.3 758.3 555.8 751.3 549.1 742.1 546 742 530.6 725 537.2 713.3 538.9 704.3 535 699.4 535.2 690.2 529.9 690.6 523.5 698.1 515.9 694.7 516.4 686.1 520.1 680.4 514.6 674.6 504.9 675.6 509.6 659.3 509.1 639.5 513.4 636.8" />
          <polygon id="cataluna" class="poligono-svg-ccaa"
            points="1268.9 567.9 1258.7 563.3 1258 558.2 1252.7 553.7 1243.2 552.4 1238.4 549.6 1237 544.8 1240.1 540.3 1233.6 537.7 1230.5 532.2 1224.4 532.2 1238.3 517.1 1234.8 511.1 1235.2 500.3 1239.1 492.6 1236.3 482 1232.1 479.7 1228.4 472 1230.6 464 1234.6 464.2 1241.6 458.4 1244 448 1248.6 447.9 1252.2 438.7 1247.5 429.7 1250.5 425.9 1243.7 418.9 1246.6 415.5 1246.5 404.1 1253.7 402.3 1260 393.3 1254.3 384.7 1247.5 383.5 1248.1 378.3 1244.9 369.2 1255.1 355.9 1263 354.8 1264.8 348.6 1272.7 345.2 1278.9 334.2 1280.2 327.6 1275.1 325.8 1286.7 310.1 1293 292.9 1292.3 287.7 1294.7 274.9 1297 271 1300.4 253.4 1292.4 231.5 1297.6 225.4 1296.1 221.2 1300.4 214 1301.5 207.7 1293.9 205.7 1292.2 199 1287.6 193.4 1289.3 188.7 1286 177.4 1289 173.2 1287.5 167.6 1293.9 163.4 1303.1 167.9 1312.9 169.5 1322.6 176.2 1327.2 173.6 1345.3 179 1348.7 186.9 1353 190.2 1359.4 188.3 1377.7 188.4 1384.9 199.6 1388.8 214.3 1386.1 217.2 1392 225.1 1388.8 227.7 1388.9 237.1 1398.4 239.4 1409.1 232.7 1416.4 232.4 1417.1 228 1425.2 226.1 1435.5 228.6 1453.4 239.4 1457 248.9 1462.2 252.6 1468.3 251.6 1475.7 247.3 1477.3 242.2 1487.3 241.3 1493.8 237.6 1516.8 245.9 1523.1 254.9 1530.6 256 1532.2 252.7 1547.4 254.8 1546 250.4 1548.4 243.3 1558.2 239.9 1563.9 241.2 1569.1 234.1 1579.2 234.5 1582.8 230.4 1595.9 234.5 1600.8 239.9 1612.1 238.3 1609.8 247.9 1615.2 255.7 1619.3 252.9 1630.7 257.8 1625.9 269.9 1607.5 270.7 1604.2 278.3 1605.8 291.8 1612.6 294.8 1616.8 302 1615.1 311.7 1619.7 319.8 1616 333 1606.9 340.8 1602.9 341.1 1595.4 352.6 1587.3 355.9 1581.3 363.6 1571 366.2 1563.1 370.7 1560.6 375.2 1531.3 387.6 1521.4 392.6 1509.7 401.5 1495.1 407.7 1489.6 416.5 1483.5 422.6 1480.3 431.1 1475.7 436.7 1462.9 441 1453 441.4 1441.7 446.4 1436.8 446.1 1416.3 453.1 1398.4 455.9 1375.8 465.2 1369.5 464.8 1359.3 468.7 1353.5 477.2 1350.1 474.2 1338.3 475.5 1330.4 479.2 1320.6 488.7 1309.2 502.2 1304.6 509.5 1292.7 520.1 1296.5 525.8 1303.1 523.5 1308.9 531.4 1315.9 533.2 1315 537.9 1310 542.5 1298.6 548.6 1280.5 550.9 1271.9 560.3 1268.9 567.9" />
          <polygon id="extremadura" class="poligono-svg-ccaa"
            points="307.3 954.5 300.6 954.3 294.8 958.8 285.6 959.1 280.4 950 280 945.8 263.3 923.5 257.8 914.9 256.8 910.2 259.3 899 264.4 891.9 263.6 883.6 265.5 869.2 272.1 865.1 281.9 854.6 286.9 853.8 294.2 844.1 291.7 839.1 304.8 819.8 300.9 809.1 294.1 804.2 284.8 807.2 279.9 805.6 281.1 795.3 269.9 791.6 266.5 781.4 268.6 777.4 258.4 766.9 256.9 759.4 260.5 747.7 249.2 741.7 247.9 735.3 243.4 734.8 238.9 728.2 234 725.3 229.2 712.3 240 713 246.8 715.8 255.7 716.7 266.4 712.3 279 714.8 289.3 713.9 296.5 711.7 301.5 694.6 300.2 688.4 305.2 685.3 310.9 678.1 311.1 668.1 315.6 655 305.9 638.9 299.4 636.4 296.6 632.4 296 623.1 298.8 616.5 304.8 612.8 315.9 610.7 319.8 614.5 330 614.8 334.8 610.9 340.9 611.9 351.8 610.7 355.5 607.4 355.2 600.8 358.3 597.7 379.2 588.7 384.5 580.6 389.6 579.9 396.6 574.2 401.6 574.7 407.3 579.1 410.9 585.2 418.2 588.7 417 595 425.6 598.9 426.9 604.8 437.8 608.9 442.6 601.2 454.1 597 457.9 608.9 467.3 607 480 619.9 488.2 623.5 495.9 621.3 501.2 613.8 512.4 611.9 509 619.5 509.3 629.2 513.4 636.8 509.1 639.5 509.6 659.3 504.9 675.6 514.6 674.6 520.1 680.4 516.4 686.1 515.9 694.7 523.5 698.1 529.9 690.6 535.2 690.2 535 699.4 538.9 704.3 537.2 713.3 530.6 725 546 742 549.1 742.1 555.8 751.3 563.3 758.3 571.3 762 588.4 754.4 596.7 748.4 599.4 753 594.2 766.2 587.6 770.3 594.4 788.8 590 791.3 581.3 790.6 575.7 798.4 573 807.7 579.1 813.4 574.7 818.5 561.6 814 565.3 827.8 577.8 835.3 576.1 843.4 567.7 842.4 564.1 847.9 560.2 863.4 558 866.9 550.7 868.7 543.7 872.2 534.9 871.3 535 877.3 529.8 878.8 523.9 885.7 519 888.2 517 893.7 509.1 892.5 502.5 904.5 494.3 912.2 489.7 912.6 483.4 917.5 481.2 925.3 482.7 934.3 488.8 945.4 489.6 954.7 487 962.4 481.2 967.1 474.9 966.1 467.2 975 462.1 974.4 461.1 968 467 963.9 467.8 958.9 460.9 956.9 443.4 963.3 436.9 974.3 439.4 977.6 433.6 989.5 421 989.3 412.3 991.9 403.8 997.9 401.6 995 388.4 992.3 381.8 987.1 380.2 980.7 374.2 979.1 363.7 985.6 351.8 984.4 352.6 980.1 347.3 972.8 329.6 973.5 323.1 970.4 325 959.5 316.8 959.2 307.3 954.5" />
          <path id="navarra" class="poligono-svg-ccaa"
            d="M889.8,228.8l3.7-4.8-.9-14.2-5.8,4-6-2.3,5.3-10.4,4.4-2.7,5.1,4.5,11.3-3.1-4.5-12.2,7.5-5-1.9-5.7,5.8-8.7-.3-15.3,3.6-5,10.4,1.9,4.4-5.9,7.3-1.5-.4-8.6,2.4-6.2,12.8-8.9,2.4-5.1-2.3-6.1,5.5-8.2,3.3,1.2,7.7-5.1,1.5-7,6.9-1.6,8-3.5,7.7,11.2,5.1-.6,4.4-7,9.5,4.1,6.2-.4,4.6,7.6-4.7,18.2-7.3,6.3,3.9,8.1,11.2,3.2,1-11,12.7,8.4,17.2,3.3,3.6,3.7,10.1,2.1,8.2,6.6,3.8-1.8,13.8,2.1,7.3-2.7,3.5,8.3-7.6-.3-4,7.9-5.5,5.3,1.2,10.8-6.8,4.5-5.9,8.1-10.6,2.5-1.4,9.1h-14.7c0,.1-2.4,9.1-2.4,9.1l-7.1,9.5-5.1-2.5-2.9,5.9,1.9,7.2-8.9,10.1-2.3,8,4,4-9,11.2-2.3,12.1,3.2,7.1-.9,9.6,6,9.2h5.4c0,.1.7,5.2.7,5.2l-4.5,4.4-5.5,13-5.1,5.3-10.3-2-2.8,2.5-9.4-3-2.4-4-7.6-2.8-7.9.4-4.2-5.5-10.4-2.2-7-3.7,1.2-9.8,9.1-11.8,5.1,2.8,11.8-1.8-2.4-10.7-12-2.3-22.1-22.7-5.7-2.7-6.8,4.6-2.3-7.2-6.8-6.5-4.5,2.2-8.2-5.8-11.2-4.8-2.9,2.6-9.4-6.3ZM1060.1,229.9l5.9,8.5-9.4-2.2,3.5-6.3Z" />
          <polygon id="rioja" class="poligono-svg-ccaa"
            points="833.3 202.6 843.5 212.9 845.5 205.4 855.7 211.6 853.1 224 869.5 229.8 889.8 228.8 899.2 235.1 902.1 232.5 913.3 237.3 921.5 243 926.1 240.8 932.8 247.3 935.1 254.4 941.9 249.8 947.6 252.5 969.7 275.2 981.7 277.6 984.1 288.3 972.3 290.2 967.2 287.4 958.1 299.2 956.8 309 963.9 312.7 962.7 320 951.8 327.1 946.5 328.2 940.5 322.2 929.1 320.5 929 310.4 923.2 302.5 926.7 296.4 913.4 296.4 903 288.9 887.5 290.3 872.9 306.2 869.2 314.7 863.2 313 855.7 314 846.6 310 852.7 299.1 849.2 292.4 844.1 292.6 840.6 299.6 841.1 305.9 826.4 310.3 823.3 298.6 810.6 299.2 806.5 290.9 798.4 279.1 803.5 271.4 800.9 252.8 808.2 249.1 806.9 240.1 809.1 236.5 803 228.4 805.7 222 797.6 219.6 806.8 210.9 806.1 202.6 814.4 201.6 830 205.1 833.3 202.6" />
          <path id="pais-vasco" class="poligono-svg-ccaa"
            d="M832,184.8l10.8,7.2,2.1,5.8,13.8-1.1,3.4,4.2,6.5-.6-3.1-7.8,6-8-6-5.2-3.4,1-12.4-5.2-11.2.8-6.6,8.8ZM761.1,115.4l-3.1-18.1,6.4-2.9,6.3-7.5,17.3,1.9,6.8-3.1.5-9.2,15-3.7,10.9-6.6.9-4.3,18.8.4,6.2-4.3,7.2,8.9,24.1,5.3,5.9,6.8,12.5,5.9,10.6,1.9,7.2-2.8,6.8,4,27.6-8.6h5.9c0,0,6-5.7,6-5.7l8.9-3.7,9.3,16.8-6.9,1.6-1.5,7-7.7,5.1-3.3-1.2-5.5,8.2,2.3,6.1-2.4,5.1-12.8,8.9-2.4,6.2.4,8.6-7.3,1.5-4.4,5.9-10.4-1.9-3.6,5,.3,15.3-5.8,8.7,1.9,5.7-7.5,5,4.5,12.2-11.3,3.1-5.1-4.5-4.4,2.7-5.3,10.4,6,2.3,5.8-4,.9,14.2-3.7,4.8-20.2,1.1-16.5-5.9,2.6-12.3-10.1-6.3-2.1,7.5-10.1-10.2-4.9-2.9-.8-6.8-11-2.7-8-10h-11.2l-2.9-6.8,1.2-10-5.3-1.4-6,5.5-5.9-6.6,7.5-13.1,10.4,2.7,2.3,5.4,13.9-.7,4.8-5.4-7.7-5.5-3.2-6.1-10.1-.4,1.4-16-6.2-4.2,4.3-9.4-9.7.3-7.1-3.9-9.3,7.1-8.6,3.8Z" />
          <path id="baleares" class="poligono-svg-ccaa"
            d="M1593.6,775.5l-8.2-11.5-23-.7-4.6-5.3-.5-7.1-3.4-6.4,3.8-4.8-3.2-4.4-11-6.3-2.5,3.3-10.9,5-1.9,10.4-5.8-3.4-1.5-7.8-12.3-1.1-3-5.4,1-7,13.8-7.9,8.4-8.2,3.6.2,14.1-12.6.5-2.8,9.5-6.9,13.2-4.8,13.7-9.8,18.7-2.7,9-4,4.8,2.7-16,9.3,3.6,5.2,7.3-2.6,2.2,5.2-8,2.7,4.5,9.8,11.6,6.2,16.9-6.4,11.4,5.1-.9,14-7.9,5.4-3.6,12.1-8.2,7.7-3.5,12.8-5.9,11.5-7.5,5.4-6.9,2.5-5.8,7.2-5.6-3.5ZM1754.4,675.7l4.3,6.1-4.3,6.7-4.9-1.1-18-10.6-9.4-7-11.3-2.9-3.4,2.1-11.8-.5,1.3-11.1-4.5-1,4-8.9h19.9c0,.1,7.2-2,7.2-2l9.5,1.7,7.5-.7,12,15.8,4.2,10.4-2.4,3ZM1384.5,841.8l-1,6.9-4.3,2.5-3.1-5.9-10.2-1.2-6.8-3.4,6.4-11.5,4.3-3-.8-6.9,8.6-6.9,10.8-2,4.4-4.1,8.7-1.9,7.5,3.9,1.2,8.2-4.3,8.8-5.8,1.9-.3,5.5-7.1,5.5-4.6-.5-3.6,4.1ZM1381.7,883.3l-1-12.9,7.7-4.2,3.3,9.7-10,7.4Z" />
          <path id="canarias" class="poligono-svg-ccaa"
            d="M1640.1,1390.3l-6,21.1-5,8.2-6.9,1.1-7.8,3.7-11.2,2.4-11.2,3.9-3.7,6.9-11,11.5-18.2-5.2,3.5-3.6,7.7-1.7,7.8-3.8,11-9.3,3.9-4.7,1.6-16.1,5.3-6.2,1.4-9.7,6.6-7,11.8-31.6-1.2-4.5,5.5-4.5,11-3.4,5.9,4.6,2.9,21.3-2.6,13.8-3.2,3.6,2.1,9.2ZM1300.5,1441.2l-9.9,10-4.8.3-6.5,4-7.9-1.1-4.1-12-4.5-4-8-15-.6-8.5-8.7-11.7,2.2-3.8,8-4.6,2.7,2.7,7.6.8,9.3-4.3,8.8.8,14.3-7,8.8-8,4.1-7.7,8.2-3,1.9-3.2,12.5,2,8.4-3.6,5,5.1-4.7,5.1-10.3,5.7-1.9,4.9-14.3,12v11.3c-.1,0-8.2,16.2-8.2,16.2l-.8,9.3-6.5,7.3ZM1130.6,1375.2l-4.6,9.5-5.6-5.6-.5-7.2-10.7-21.2-5.5-17.1,7.6-9,5.3-2,6,3.4,8.8-1.4,8.6,16.3-5.9,9.7,2.1,7.4-.8,9.4-4.7,8ZM1683.4,1302.6l-3.2,3.4-7.3,1.8-6.2,4.6-12.1,2.2-4.6,9-7.1-2.3-6.1.6,5.5-12.7.6-10.5,1.9-4.2,7.5-6.8,6.4-.4,5.5-4.8,7.8-4,5.7,3.1,4.6-4.1,3.6-12.1,6.3-.8,3.7,3.2-1.2,7.5-4.6,4.2,2.1,5.8-3.7,13.5-5.1,3.9ZM1681.1,1265.6l3.4-11.7,4.7,3.9-4.5,6.4-3.5,1.5ZM1215.6,1431.1l2.6,1.5,2.6,8.6-12.8,11.1-6.1.7-8.2-4.9-5.2-7.3,1.6-11.8,4-4.6,5.8-1.9,7.9,2.3,8,6.3ZM1434.7,1430.8l3.9,9.2-1.1,6.6,6.8,10.8-3.4,15.5-5.8,14.2-7.3,1.6-8.6,4.3-4.9,4.3-8-3.4-13.6-9.4-2.9-3.1-5.7-11.4v-9.3c-.1,0,2.5-7.3,2.5-7.3l4.3-1.2,9.4-9.9.2-10.7,8.7-2.3,5.1,4.3,9.3-1.7,7.5,4.4,3.5-5.6ZM1109.4,1503.8l-1.2,6.7h-5c0,0-6.2-7.1-6.2-7.1l-11.5-1.5-.5-8.8,2.5-1.6,7.6,2.8,9.5-5.8,2.7-5.4,6.6-3.7,5.5,7.2-2.5,2.7-7.5,14.5Z" />
          <polyline id="linea-canarias" class="linea-svg-canarias" points="1012.8 1537.4 1012.8 1206.3 1709.8 1206.3" />
          <rect id="melilla" class="poligono-svg-ccaa" x="485.5" y="1363" width="52.8" height="52.8" />
          <rect id="ceuta" class="poligono-svg-ccaa" x="742.5" y="1471" width="52.8" height="52.8" />
        </svg>
      </div>
      <div id="div-tabla">
        <div id="columna-region-nom">
          <div class="fila-region-nom" id="nom-andalucia">Andalucía</div>
          <div class="fila-region-nom" id="nom-aragon">Aragón</div>
          <div class="fila-region-nom" id="nom-asturias">Asturias</div>
          <div class="fila-region-nom" id="nom-baleares">Baleares</div>
          <div class="fila-region-nom" id="nom-canarias">Canarias</div>
          <div class="fila-region-nom" id="nom-cyl">CyL</div>
          <div class="fila-region-nom" id="nom-clm">C-LM</div>
          <div class="fila-region-nom" id="nom-cantabria">Cantabria</div>
          <div class="fila-region-nom" id="nom-c-valenciana">C. Valenciana</div>
          <div class="fila-region-nom" id="nom-cataluna">Cataluña</div>
          <div class="fila-region-nom" id="nom-extremadura">Extremadura</div>
          <div class="fila-region-nom" id="nom-galicia">Galicia</div>
          <div class="fila-region-nom" id="nom-madrid">Madrid</div>
          <div class="fila-region-nom" id="nom-murcia">Murcia</div>
          <div class="fila-region-nom" id="nom-navarra">Navarra</div>
          <div class="fila-region-nom" id="nom-rioja">La Rioja</div>
          <div class="fila-region-nom" id="nom-pais-vasco">País Vasco</div>
          <div class="fila-region-nom" id="nom-ceuta">Ceuta</div>
          <div class="fila-region-nom" id="nom-melilla">Melilla</div>
        </div>
        <div id="columna-region-datos">
          <div class="fila-region-datos" id="dato-andalucia">XX</div>
          <div class="fila-region-datos" id="dato-aragon">XX</div>
          <div class="fila-region-datos" id="dato-asturias">XX</div>
          <div class="fila-region-datos" id="dato-baleares">XX</div>
          <div class="fila-region-datos" id="dato-canarias">XX</div>
          <div class="fila-region-datos" id="dato-cyl">XX</div>
          <div class="fila-region-datos" id="dato-clm">XX</div>
          <div class="fila-region-datos" id="dato-cantabria">XX</div>
          <div class="fila-region-datos" id="dato-c-valenciana">XX</div>
          <div class="fila-region-datos" id="dato-cataluna">XX</div>
          <div class="fila-region-datos" id="dato-extremadura">XX</div>
          <div class="fila-region-datos" id="dato-galicia">XX</div>
          <div class="fila-region-datos" id="dato-madrid">XX</div>
          <div class="fila-region-datos" id="dato-murcia">XX</div>
          <div class="fila-region-datos" id="dato-navarra">XX</div>
          <div class="fila-region-datos" id="dato-rioja">XX</div>
          <div class="fila-region-datos" id="dato-pais-vasco">XX</div>
          <div class="fila-region-datos" id="dato-ceuta">XX</div>
          <div class="fila-region-datos" id="dato-melilla">XX</div>
        </div>
      </div>
    </div>
    <hr>
    <div id="pie-grafico">
      <p class="texto-pie" id="fuente">Fuente: XX - EpData (2025)</p>
      <p class="texto-pie" id="nota-ceuta-melilla">Nota: Sin datos para Ceuta y Melilla</p>
    </div>
  </div>
  <div id="paneles-colores">

  </div>
  <div id="panel-sugerencias-color">
  <label for="selectorSugerencias">Tipo de escala sugerida:</label>
  <select id="selectorSugerencias"></select>
  <div id="sugerencias-color"></div>
</div>
  <script>
    let valores = []; // Mover esto FUERA de processCSV para que sea accesible globalmente

    function processCSV(text) {
      const lines = text.trim().split('\n');

      const regionMap = {
        'Andalucía': 'dato-andalucia',
        'Aragón': 'dato-aragon',
        'Asturias, Principado de': 'dato-asturias',
        'Balears, Illes': 'dato-baleares',
        'Canarias': 'dato-canarias',
        'Cantabria': 'dato-cantabria',
        'Castilla y León': 'dato-cyl',
        'Castilla - La Mancha': 'dato-clm',
        'Cataluña': 'dato-cataluna',
        'Comunitat Valenciana': 'dato-c-valenciana',
        'C. Valenciana': 'dato-c-valenciana',
        'Extremadura': 'dato-extremadura',
        'Galicia': 'dato-galicia',
        'Madrid, Comunidad de': 'dato-madrid',
        'Murcia, Región de': 'dato-murcia',
        'Navarra, Comunidad Foral de': 'dato-navarra',
        'Rioja, La': 'dato-rioja',
        'País Vasco': 'dato-pais-vasco',
        'Ceuta': 'dato-ceuta',
        'Melilla': 'dato-melilla'
      };

      valores = []; // Reiniciar al cargar nuevo CSV

      let ceutaData = false;
      let melillaData = false;

      for (let line of lines) {
        const [label, regionName, valueRaw] = line.split(';').map(s => s.trim());

        if (!label || !regionName || !valueRaw || regionName.toLowerCase().includes('total')) continue;

        const regionId = regionMap[regionName];
        const valueNum = parseFloat(valueRaw.replace(',', '.')); // Asegurar parse correcto con coma

        if (!regionId || isNaN(valueNum)) continue;

        if (regionId === 'dato-ceuta') ceutaData = true;
        if (regionId === 'dato-melilla') melillaData = true;

        valores.push({
          regionId,
          valueNum
        });
      }

      // Oculta todas las filas
      document.querySelectorAll('[id^="nom-"], [id^="dato-"]').forEach(el => {
        el.style.display = 'none';
      });

      // Oculta la nota de Ceuta y Melilla por defecto
      document.getElementById('nota-ceuta-melilla').style.display = 'none';

      // Ordenar
      valores.sort((a, b) => b.valueNum - a.valueNum);

      // Mostrar
      const colNom = document.getElementById('columna-region-nom');
      const colDato = document.getElementById('columna-region-datos');

      const toggleChecked = document.getElementById('toggleSymbols').checked;

      valores.forEach(({ regionId, valueNum }) => {
        const nomId = 'nom-' + regionId.replace('dato-', '');
        const nomEl = document.getElementById(nomId);
        const datoEl = document.getElementById(regionId);
        const regionEl = document.getElementById(regionId.replace('dato-', ''));

        if (nomEl && datoEl && regionEl) {
          nomEl.style.display = 'flex';
          datoEl.style.display = 'flex';

          let displayValue = valueNum.toFixed(1).replace('.', ',');
          if (toggleChecked) {
            displayValue = (valueNum > 0 ? '+' : '') + displayValue + '%';
          }

          datoEl.textContent = displayValue;

          // Colorear el mapa en gris claro
          const color = '#d3d3d3'; // Gris claro
          if (regionEl.tagName === 'g') {
            regionEl.querySelectorAll('*').forEach(el => el.style.fill = color);
          } else if (regionEl.tagName === 'rect' || regionEl.tagName === 'polygon' || regionEl.tagName === 'path') {
            regionEl.style.fill = color;
          }

          datoEl.style.backgroundColor = color;
          datoEl.style.textAlign = 'center';
          colNom.appendChild(nomEl);
          colDato.appendChild(datoEl);
        }
      });

      // Mostrar la nota si no hay datos para Ceuta y Melilla
      if (!ceutaData && !melillaData) {
        document.getElementById('nota-ceuta-melilla').style.display = 'block';
      }
      // === GENERAR SUGERENCIAS DE ESCALAS DIDÁCTICAS ===
      const sugerenciasDiv = document.getElementById('sugerencias-color');
      const selector = document.getElementById('selectorSugerencias') || document.createElement('select');

      if (valores.length > 0) {
        const nums = valores.map(d => d.valueNum).sort((a, b) => a - b);
        const min = nums[0];
        const max = nums[nums.length - 1];
        const media = nums.reduce((a, b) => a + b, 0) / nums.length;
        const desv = Math.sqrt(nums.map(v => (v - media) ** 2).reduce((a, b) => a + b) / nums.length);
        const positivos = nums.filter(n => n > 0);

        function red(n) {
          return Math.round(n * 10) / 10;
        }

        function cuantiles(arr, partes) {
          const sorted = [...arr].sort((a, b) => a - b);
          const q = [];
          for (let i = 0; i <= partes; i++) {
            const p = i / partes;
            const pos = (sorted.length - 1) * p;
            const base = Math.floor(pos);
            const rest = pos - base;
            const valor = sorted[base + 1] !== undefined
              ? red(sorted[base] + rest * (sorted[base + 1] - sorted[base]))
              : red(sorted[base]);
            q.push(valor);
          }
          return [...new Set(q)].sort((a, b) => a - b);
        }

        function logBreaks(posValues, partes) {
          const minLog = Math.log10(posValues[0]);
          const maxLog = Math.log10(posValues[posValues.length - 1]);
          const breaks = Array.from({ length: partes }, (_, i) =>
            red(Math.pow(10, minLog + i * (maxLog - minLog) / (partes - 1)))
          );
          return [...new Set([min, 0, ...breaks, max])];
        }
        const hayPositivos = nums.some(n => n > 0);
const hayNegativos = nums.some(n => n < 0);
const mezclaSignos = hayPositivos && hayNegativos;
        const cortes = {
'intervalos': {
  titulo: 'Intervalos iguales',
  descripcion: 'Divide el rango entre el mínimo y el máximo en partes del mismo tamaño.' +
    (mezclaSignos ? '<br><p style="color:red"><strong>Nota:</strong> solo usar si todos los valores son positivos o todos negativos, no si hay mezcla.</p>' : ''),
  ejemplo: 'Por ejemplo, si tienes valores entre 0 y 100 y eliges 4 cortes, serán: 0–25, 25–50, 50–75, 75–100.',
  valores: Array.from({ length: 5 }, (_, i) => red(min + (i * (max - min)) / 4))
},
'cuantiles': {
  titulo: 'Cuantiles',
  descripcion: 'Agrupa los datos en bloques con igual número de elementos. Los rangos pueden ser desiguales.' +
    (mezclaSignos ? '<br><p style="color:red"><strong>Nota:</strong> solo usar si todos los valores son positivos o todos negativos, no si hay mezcla.</p>' : ''),
  ejemplo: 'Ideal para ver qué regiones están en el 25 %, 50 % o 75 % superior.',
  valores: cuantiles(nums, 4)
},
          'naturales': {
            titulo: 'Cortes naturales',
            descripcion: 'Cortes comunes usados para datos sociales: valores negativos, bajos, medios, altos...',
            ejemplo: 'Por ejemplo: <0, 0–15, 15–30, etc.',
            valores: [Math.floor(min), 0, 15, 30, 50, Math.ceil(max)]
          },
          'manuales': {
            titulo: 'Cortes manuales',
            descripcion: 'Tú decides qué rangos usar, por ejemplo en relación a una media nacional o política.',
            ejemplo: 'Por ejemplo: <0, 0–20, 20–40, >40.',
            valores: [min, 0, 20, 40, max]
          },
          'logaritmica': {
            titulo: 'Escala logarítmica',
            descripcion: 'Útil para datos muy desiguales. Destaca los valores bajos, comprime los altos.',
            ejemplo: 'Usada en población, PIB, etc.',
            valores: logBreaks(positivos, 4)
          },
          'desviacion': {
            titulo: 'Desviaciones estándar',
            descripcion: 'Divide los datos según su distancia a la media. Muy útil para análisis técnico.',
            ejemplo: 'Por ejemplo: muy por debajo, por debajo, en la media, por encima, etc.',
            valores: [...new Set([min, 0, red(media - desv), red(media), red(media + desv), max])]
          }
        };

        // Crear selector si no existe
        selector.id = 'selectorSugerencias';
        selector.innerHTML = '';
        for (const clave in cortes) {
          const opt = document.createElement('option');
          opt.value = clave;
          opt.textContent = cortes[clave].titulo;
          selector.appendChild(opt);
        }

        // Insertar selector y contenedor si aún no están
        if (!document.getElementById('selectorSugerencias')) {
          sugerenciasDiv.before(selector);
        }

        // Función para renderizar el bloque explicativo
        function renderSugerencia(tipo) {
          const c = cortes[tipo];
          const tramos = c.valores.map((v, i) => i < c.valores.length - 1 ? `${v} – ${c.valores[i + 1]}` : '').filter(Boolean).join('<br>');
          sugerenciasDiv.innerHTML = `
      <div class="sugerencia-color">
        <h4 class="titulo-sugerencia">${c.titulo}</h4>
        <p>${c.descripcion}</p>
        <p><em>${c.ejemplo}</em></p>
        <p><strong>Sugerencia según tus datos:</strong></p>
        <p style="font-family: monospace;">${tramos}</p>
      </div>
    `;
        }

        // Mostrar por defecto
        renderSugerencia(selector.value);
        selector.onchange = () => renderSugerencia(selector.value);
      }


    }


    function setMapToGray() {
      // Cambiar el color de los elementos polygon con la clase .poligono-svg-ccaa
      document.querySelectorAll('#mapa .poligono-svg-ccaa').forEach(el => {
        el.style.fill = '#d3d3d3'; // Color gris claro
      });

      // Cambiar el color de los elementos rect de Ceuta y Melilla
      document.querySelectorAll('#ceuta, #melilla').forEach(el => {
        el.style.fill = '#d3d3d3'; // Color gris claro
      });

      // Cambiar el background-color de las filas
      document.querySelectorAll('.fila-region-datos').forEach(el => {
        el.style.backgroundColor = '#d3d3d3'; // Color gris claro
      });
    }

    function injectColorSelectors() {
  const panelesDiv = document.getElementById('paneles-colores');

  const colorSelectorsHTML = `
    <div>
      <label for="colorScales">Número de escalas de color:</label>
      <input type="number" id="colorScales" min="1" value="1" />
    </div>
    <div id="scaleInputs"></div>
  `;

  panelesDiv.insertAdjacentHTML('beforeend', colorSelectorsHTML);

  // Añadir evento para mostrar los inputs de las escalas de color
  document.getElementById('colorScales').addEventListener('input', function () {
    const scaleInputsDiv = document.getElementById('scaleInputs');
    scaleInputsDiv.innerHTML = ''; // Limpiar los inputs anteriores
    const numScales = parseInt(this.value, 10);
    for (let i = 0; i < numScales; i++) {
      const inputHTML = `
        <div class="input-individual">
          <label for="scaleValue${i}">Escala ${i + 1}:</label>
          <input type="number" id="scaleValue${i}-min" placeholder="Introducir valor mínimo" />
          <input type="number" id="scaleValue${i}-max" placeholder="Introducir valor máximo" />
          <input type="color" id="scaleColorPicker${i}" value="#000000" />
          <input type="text" id="scaleColor${i}" value="#000000" placeholder="Pegar valor RGB" />
        </div>
      `;
      scaleInputsDiv.insertAdjacentHTML('beforeend', inputHTML);

      // Sincronizar el input de color y el input de texto
      const colorPicker = document.getElementById(`scaleColorPicker${i}`);
      const colorInput = document.getElementById(`scaleColor${i}`);

      colorPicker.addEventListener('input', function () {
        colorInput.value = colorPicker.value;
        updateColors();
      });

      colorInput.addEventListener('input', function () {
        colorPicker.value = colorInput.value;
        updateColors();
      });
    }
  });

  // Disparar el evento para mostrar los inputs de las escalas de color al cargar la página
  document.getElementById('colorScales').dispatchEvent(new Event('input'));
}

function updateColors() {
  const scales = [];
  const numScales = parseInt(document.getElementById('colorScales').value, 10);

  for (let i = 0; i < numScales; i++) {
    const min = parseFloat(document.getElementById(`scaleValue${i}-min`).value);
    const max = parseFloat(document.getElementById(`scaleValue${i}-max`).value);
    const color = document.getElementById(`scaleColor${i}`).value;
    scales.push({ min, max, color });
  }

  valores.forEach(({ regionId, valueNum }) => {
    const datoEl = document.getElementById(regionId);
    const regionEl = document.getElementById(regionId.replace('dato-', ''));

    if (datoEl && datoEl.style.display !== 'none') {
      let color = '';

      for (const scale of scales) {
        if (valueNum >= scale.min && valueNum <= scale.max) {
          color = scale.color;
          break;
        }
      }

      if (color) {
        datoEl.style.backgroundColor = color;

        if (regionEl) {
          if (regionEl.tagName === 'g') {
            regionEl.querySelectorAll('*').forEach(el => el.style.fill = color);
          } else if (regionEl.tagName === 'rect' || regionEl.tagName === 'polygon' || regionEl.tagName === 'path') {
            regionEl.style.fill = color;
          }
        }
      }
    }
  });
}

    // Carga archivo CSV
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const text = event.target.result;
        processCSV(text);
        injectColorSelectors(); // Inyectar los selectores de color después de cargar los datos
      };
      reader.readAsText(file, 'UTF-8');
    });


    // Evento para actualizar el título
    document.getElementById('tituloInput').addEventListener('input', function () {
      const titulo = this.value.trim();
      const titularEl = document.getElementById('titular');
      titularEl.textContent = titulo;
    });

    // Evento para actualizar el subtítulo
    document.getElementById('subtituloInput').addEventListener('input', function () {
      const subtitulo = this.value.trim();
      const subtituloEl = document.getElementById('subtitulo');
      if (subtitulo) {
        subtituloEl.textContent = subtitulo;
        subtituloEl.style.display = 'block';
      } else {
        subtituloEl.style.display = 'none';
      }
    });

    // Evento para actualizar la nota de Ceuta y Melilla
    document.getElementById('notaCeutaMelillaInput').addEventListener('input', function () {
      const nota = this.value.trim();
      const notaEl = document.getElementById('nota-ceuta-melilla');
      if (nota) {
        notaEl.textContent = "Nota: " + nota;
        notaEl.style.display = 'block';
      } else {
        notaEl.style.display = 'none';
      }
    });

    // Toggle symbols
    document.getElementById('toggleSymbols').addEventListener('change', function () {
      const scales = [];
      const numScales = parseInt(document.getElementById('colorScales').value, 10);

      for (let i = 0; i < numScales; i++) {
        const min = parseFloat(document.getElementById(`scaleValue${i}-min`).value);
        const max = parseFloat(document.getElementById(`scaleValue${i}-max`).value);
        const color = document.getElementById(`scaleColor${i}`).value;
        scales.push({ min, max, color });
      }

      valores.forEach(({ regionId, valueNum }) => {
        const datoEl = document.getElementById(regionId);
        if (datoEl && datoEl.style.display !== 'none') {
          let displayValue = valueNum.toFixed(1).replace('.', ',');
          if (this.checked) {
            displayValue = (valueNum > 0 ? '+' : '') + displayValue + '%';
          }
          datoEl.textContent = displayValue;

          // Actualizar el color de fondo
          let color = '';
          for (const scale of scales) {
            if (valueNum >= scale.min && valueNum <= scale.max) {
              color = scale.color;
              break;
            }
          }
          datoEl.style.backgroundColor = color;
        }
      });
    });


    // Evento para actualizar la fuente
    document.getElementById('fuenteInput').addEventListener('input', function () {
      const fuente = this.value.trim();
      const fuenteEl = document.getElementById('fuente');
      fuenteEl.textContent = `Fuente: ${fuente} - EpData (2025)`;
    });

    // Función para descargar el mapa como imagen
    document.getElementById('downloadButton').addEventListener('click', function () {
      const titularEl = document.getElementById('titular');
      const fuenteEl = document.getElementById('fuente');
      const titulo = titularEl.textContent.trim();
      const fuente = fuenteEl.textContent.trim();

      if (!titulo || titulo === 'Titular del gráfico') {
        alert('Por favor, introduzca un título.');
        return;
      }

      if (!fuente || fuente === 'Fuente: XX - EpData (2025)') {
        alert('Por favor, introduzca la fuente.');
        return;
      }

      const tituloArchivo = titulo.toLowerCase().replace(/\s+/g, '-');
      const graficoEl = document.getElementById('grafico-principal');

      html2canvas(graficoEl, { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = `${tituloArchivo}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 1.0);
        link.click();
      });
    });
  </script>
</body>

</html>